# 时间序列分析

<!-- toc -->

# 概述

时间序列分析是统计学和数据科学中的一个重要领域，主要用于分析随时间变化的数据。通过时间序列分析，我们可以识别数据中的模式、趋势和季节性，并进行预测。以下是一些常见的时间序列分析方法及其要点。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250107094651.png)

## 时间序列的平稳性

平稳时间序列是其性质与观测时间无关的序列，因此，具有趋势或季节性的时间序列不是平稳的一趋势和季节性会在不同时间影响时间序列的值.另一方面，白噪声序列是平稳的一—你什么时候观察它并不重要，它在任何时间点看起来都应该是一样的。

值得注意的是具有周期性行为(但没有趋势或季节性)的时间序列是平稳的.这是因为周期的长度不是固定的，所以在我们观察这个序列之前，我们无法确定周期的波峰和波谷在哪里。

时间序列平稳性评估——自相关系数ACF和偏自相关系数PACF

如果时间序列是平稳的，那么它的ACF和PACF图应该很快地下降到O，并在O附近波动，如果时间序列不稳定则ACF和PACF图会显示出明显的趋势或周期性。

差分方程可以使非平稳时间序列变为平稳，其原理就是计算连续观测值之间的差异，差分可以通过消除时间序列水平的变化来帮助稳定时间序列的平均值，从而消除(或减少)趋势和季节性。

# 常见的时间序列分析方法

## 1. 自回归模型 (AR)

### 1.1 定义

自回归模型（AR）是基于过去值的线性组合来预测当前值，形式为：
$$
X_t = c + \phi_1 X_{t-1} + \phi_2 X_{t-2} + \ldots + \phi_p X_{t-p} + \epsilon_t
$$
其中，$c$ 是常数项，$\phi_i$ 是自回归系数，$\epsilon_t$ 是白噪声。

### 1.2 要点

- 需要确定模型的阶数 $p$，通常使用自相关函数（ACF）和偏自相关函数（PACF）。
- 模型假设数据是平稳的。

#### Python 示例

```python
import pandas as pd
import numpy as np
from statsmodels.tsa.ar_model import AutoReg
import matplotlib.pyplot as plt

# 生成示例时间序列数据
np.random.seed(0)
data = pd.Series(np.random.randn(100).cumsum())

# 拟合自回归模型
model = AutoReg(data, lags=1)
model_fit = model.fit()

# 进行预测
predictions = model_fit.predict(start=len(data), end=len(data)+10)

# 绘制结果
plt.figure(figsize=(10, 5))
plt.plot(data, label='原始数据')
plt.plot(range(len(data), len(data)+11), predictions, label='预测', color='red')
plt.legend()
plt.title('自回归模型预测')
plt.show()
```

#### MATLAB 示例

```matlab
% 生成示例时间序列数据
data = cumsum(randn(100, 1));

% 拟合自回归模型
model = ar(data, 1);

% 进行预测
predictions = forecast(model, 10);

% 绘制结果
figure;
plot(data);
hold on;
plot(length(data)+1:length(data)+10, predictions, 'r');
title('自回归模型预测');
xlabel('时间');
ylabel('值');
legend('原始数据', '预测');
hold off;
```

## 2. 移动平均模型 (MA)

### 2.1 定义

移动平均模型（MA）是基于过去预测误差的线性组合来预测当前值，形式为：
$$
X_t = \mu + \theta_1 \epsilon_{t-1} + \theta_2 \epsilon_{t-2} + \ldots + \theta_q \epsilon_{t-q} + \epsilon_t
$$
其中，$\mu$ 是均值，$\theta_i$ 是移动平均系数，$\epsilon_t$ 是白噪声。

### 2.2 要点

- 需要确定模型的阶数 $q$，通常使用自相关函数（ACF）。
- 模型同样假设数据是平稳的。

#### Python 示例

```python
from statsmodels.tsa.arima.model import ARIMA

# 拟合移动平均模型
model = ARIMA(data, order=(0, 0, 1))  # MA(1)
model_fit = model.fit()

# 进行预测
predictions = model_fit.forecast(steps=10)

# 绘制结果
plt.figure(figsize=(10, 5))
plt.plot(data, label='原始数据')
plt.plot(range(len(data), len(data)+11), predictions, label='预测', color='red')
plt.legend()
plt.title('移动平均模型预测')
plt.show()
```

#### MATLAB 示例

```matlab
% 拟合移动平均模型
model = arima('Constant', 0, 'D', 0, 'Seasonality', 0, 'MA', 0.5);
fitModel = estimate(model, data);

% 进行预测
[YF, YMSE] = forecast(fitModel, 10, 'Y0', data);

% 绘制结果
figure;
plot(data);
hold on;
plot(length(data)+1:length(data)+10, YF, 'r');
title('移动平均模型预测');
xlabel('时间');
ylabel('值');
legend('原始数据', '预测');
hold off;
```

## 3. 自回归滑动平均模型 (ARMA)

### 3.1 定义

自回归滑动平均模型（ARMA）结合了AR和MA模型，形式为：
$$
X_t = c + \phi_1 X_{t-1} + \ldots + \phi_p X_{t-p} + \theta_1 \epsilon_{t-1} + \ldots + \theta_q \epsilon_{t-q} + \epsilon_t
$$

### 3.2 要点

- 适用于平稳时间序列。
- 需要同时确定阶数 $p$ 和 $q$。

#### Python 示例

```python
# 拟合ARMA模型
model = ARIMA(data, order=(1, 0, 1))  # ARMA(1, 1)
model_fit = model.fit()

# 进行预测
predictions = model_fit.forecast(steps=10)

# 绘制结果
plt.figure(figsize=(10, 5))
plt.plot(data, label='原始数据')
plt.plot(range(len(data), len(data)+11), predictions, label='预测', color='red')
plt.legend()
plt.title('自回归滑动平均模型预测')
plt.show()
```

#### MATLAB 示例

```matlab
% 拟合ARMA模型
model = arima('AR', 0.5, 'MA', 0.5);
fitModel = estimate(model, data);

% 进行预测
[YF, YMSE] = forecast(fitModel, 10, 'Y0', data);

% 绘制结果
figure;
plot(data);
hold on;
plot(length(data)+1:length(data)+10, YF, 'r');
title('自回归滑动平均模型预测');
xlabel('时间');
ylabel('值');
legend('原始数据', '预测');
hold off;
```

## 4. 自回归积分滑动平均模型 (ARIMA)

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250123102751.png)

### 4.1 定义

自回归积分滑动平均模型（ARIMA）用于非平稳时间序列，形式为：
$$
\Delta^d X_t = c + \phi_1 X_{t-1} + \ldots + \phi_p X_{t-p} + \theta_1 \epsilon_{t-1} + \ldots + \theta_q \epsilon_{t-q} + \epsilon_t
$$
其中，$\Delta^d$ 是差分操作，$d$ 是差分次数。

### 4.2 要点

- 需要进行差分以使时间序列平稳。
- 需要确定阶数 $p$、$d$ 和 $q$。

#### Python 示例

```python
# 拟合ARIMA模型
model = ARIMA(data, order=(1, 1, 1))  # ARIMA(1, 1, 1)
model_fit = model.fit()

# 进行预测
predictions = model_fit.forecast(steps=10)

# 绘制结果
plt.figure(figsize=(10, 5))
plt.plot(data, label='原始数据')
plt.plot(range(len(data), len(data)+11), predictions, label='预测', color='red')
plt.legend()
plt.title('自回归积分滑动平均模型预测')
plt.show()
```

#### MATLAB 示例

```matlab
% 拟合ARIMA模型
model = arima('AR', 0.5, 'D', 1, 'MA', 0.5);
fitModel = estimate(model, data);

% 进行预测
[YF, YMSE] = forecast(fitModel, 10, 'Y0', data);

% 绘制结果
figure;
plot(data);
hold on;
plot(length(data)+1:length(data)+10, YF, 'r');
title('自回归积分滑动平均模型预测');
xlabel('时间');
ylabel('值');
legend('原始数据', '预测');
hold off;
```

## 5. 季节性自回归积分滑动平均模型 (SARIMA)

### 5.1 定义

季节性自回归积分滑动平均模型（SARIMA）扩展了ARIMA模型，适用于具有季节性的数据，形式为：
$$
SARIMA(p, d, q)(P, D, Q)_s
$$
其中，$s$ 是季节性周期。

### 5.2 要点

- 需要识别季节性模式。
- 需要确定季节性参数 $P$、$D$ 和 $Q$。

#### Python 示例

```python
from statsmodels.tsa.statespace.sarimax import SARIMAX

# 拟合SARIMA模型
model = SARIMAX(data, order=(1, 1, 1), seasonal_order=(1, 1, 1, 12))  # SARIMA(1, 1, 1)(1, 1, 1, 12)
model_fit = model.fit()

# 进行预测
predictions = model_fit.forecast(steps=10)

# 绘制结果
plt.figure(figsize=(10, 5))
plt.plot(data, label='原始数据')
plt.plot(range(len(data), len(data)+11), predictions, label='预测', color='red')
plt.legend()
plt.title('季节性自回归积分滑动平均模型预测')
plt.show()
```

#### MATLAB 示例

```matlab
% 拟合SARIMA模型
model = arima('AR', 0.5, 'D', 1, 'MA', 0.5, 'Seasonality', 12);
fitModel = estimate(model, data);

% 进行预测
[YF, YMSE] = forecast(fitModel, 10, 'Y0', data);

% 绘制结果
figure;
plot(data);
hold on;
plot(length(data)+1:length(data)+10, YF, 'r');
title('季节性自回归积分滑动平均模型预测');
xlabel('时间');
ylabel('值');
legend('原始数据', '预测');
hold off;
```

## 6. 指数平滑法

### 6.1 定义

指数平滑法是一种简单而有效的时间序列预测方法，通过对过去观测值施加指数衰减权重来进行预测，公式为：
$$
S_t = \alpha X_t + (1 - \alpha) S_{t-1}
$$
其中，$S_t$ 是平滑值，$\alpha$ 是平滑系数，$X_t$ 是观测值。

### 6.2 要点

- 适用于平稳或趋势型时间序列。
- 平滑系数 $\alpha$ 通常在 $0 < \alpha < 1$ 之间。

#### Python 示例

```python
from statsmodels.tsa.holtwinters import ExponentialSmoothing

# 拟合指数平滑模型
model = ExponentialSmoothing(data, trend='add', seasonal='add', seasonal_periods=12)
model_fit = model.fit()

# 进行预测
predictions = model_fit.forecast(steps=10)

# 绘制结果
plt.figure(figsize=(10, 5))
plt.plot(data, label='原始数据')
plt.plot(range(len(data), len(data)+11), predictions, label='预测', color='red')
plt.legend()
plt.title('指数平滑法预测')
plt.show()
```

#### MATLAB 示例

```matlab
% 拟合指数平滑模型
model = fit(ExponentialSmoothing(data));

% 进行预测
[YF, YMSE] = forecast(model, 10);

% 绘制结果
figure;
plot(data);
hold on;
plot(length(data)+1:length(data)+10, YF, 'r');
title('指数平滑法预测');
xlabel('时间');
ylabel('值');
legend('原始数据', '预测');
hold off;
```

## 7. 总结

时间序列分析方法众多，各种方法适用于不同类型的数据和分析需求。通过合适的模型选择和参数调整，可以有效地进行时间序列预测。


